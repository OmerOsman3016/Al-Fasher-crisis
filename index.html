<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Al Fasher | RSF-Controlled Locations (OSM)</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous" />
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#0b1224cc;     /* translucent */
      --text:#e5e7eb;        /* gray-200 */
      --muted:#93a4bd;       /* bluish gray */
      --accent:#60a5fa;      /* blue-400 */
      --danger:#ef4444;      /* red-500 */
      --danger-2:#ea580c;    /* orange-600 */
    }
    html, body { height:100%; }
    body{
      margin:0; background:radial-gradient(1200px 700px at 20% 0%, #0b1224 0, #0b1224 40%, #0f172a 80%);
      color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      display:flex; flex-direction:column; min-height:100vh;
    }
    .app-header{
      display:flex; align-items:center; gap:14px; padding:10px 14px; backdrop-filter:saturate(1.2) blur(6px);
      background:linear-gradient(180deg, #0e1529e6, #0b1224cc); border-bottom:1px solid #1f2a44;
    }
    .brand{ display:flex; align-items:center; gap:12px; min-width:0; }
    .brand .flag{ width:38px; height:26px; border-radius:8px; overflow:hidden; box-shadow:0 0 0 1px #1f2a44 inset; }
    .brand h1{ font-size:16px; line-height:1.1; margin:0; }
    .brand .sub{ font-size:12px; color:var(--muted); }

    .toolbar{ margin-left:auto; display:flex; align-items:center; gap:8px; }
    .btn{ appearance:none; border:1px solid #24314f; background:#0b1224; color:#dbe5ff; padding:6px 10px; border-radius:12px; font-weight:600; font-size:12px; cursor:pointer; }
    .btn:hover{ border-color:#2f4065; box-shadow:0 0 0 2px #0b1224; }

    .map-wrap{ position:relative; flex:1 1 auto; min-height:0; }
    #map{ position:absolute; inset:0; }

    .legend{
      position:absolute; left:12px; bottom:12px; z-index:600;
      background:var(--panel); border:1px solid #223259; border-radius:12px; padding:10px 12px; color:#dbe5ff;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    .legend h3{ margin:0 0 8px; font-size:13px; letter-spacing:.2px; }
    .legend .row{ display:grid; grid-template-columns:18px 1fr; gap:8px; align-items:center; font-size:12px; color:#b9c8e8; }

    .notice{ position:absolute; right:12px; bottom:12px; z-index:600; max-width:360px; line-height:1.35; font-size:12px; color:#c1cde6; background:var(--panel); border:1px solid #223259; border-radius:12px; padding:10px 12px; }
    .notice a{ color:#cfe1ff; }

    .src-chip{ display:inline-block; padding:2px 6px; background:#0e1b35; border:1px solid #23345b; border-radius:999px; color:#cfe1ff; font-size:11px; }
  </style>
</head>
<body>
  <header class="app-header" role="banner">
    <div class="brand">
      <div class="flag" aria-label="Sudan flag">
        <svg viewBox="0 0 3 2" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
          <rect width="3" height="2" fill="#000"/>
          <rect width="3" height="1.3333" y="0.3333" fill="#ffffff"/>
          <rect width="3" height="0.6667" fill="#D21034"/>
          <polygon points="0,0 0,2 1,1" fill="#007229"/>
        </svg>
      </div>
      <div>
        <h1>Al Fasher | RSF-Controlled Locations (Public Reporting)</h1>
        <div class="sub">Base: OpenStreetMap · Last updated: <span id="stamp"></span></div>
      </div>
    </div>
    <div class="toolbar" aria-label="Map controls">
      <button id="btn-reset" class="btn" title="Reset view">Reset view</button>
    </div>
  </header>

  <div class="map-wrap">
    <div id="map" role="region" aria-label="Map of RSF-controlled or held locations around Al Fasher"></div>

    <!-- Legend -->
    <div class="legend" id="legend">
      <h3>Layers & symbology</h3>
      <div class="row"><span style="width:14px;height:14px;border-radius:50%;background:var(--danger);box-shadow:0 0 10px rgba(239,68,68,.5);"></span><span>RSF control (point)</span></div>
      <div class="row"><span style="width:18px;height:6px;border-radius:4px;background:linear-gradient(90deg,var(--danger),var(--danger-2));"></span><span>Approximate area of control</span></div>
      <div class="row"><span style="width:14px;height:14px;border-radius:50%;background:var(--accent);"></span><span>Reference place</span></div>
    </div>

    <!-- Disclaimer/notice -->
    <div class="notice">
      <strong>Important:</strong> Locations and extents are <em>approximate</em> and compiled from public reports for humanitarian visualization. Control is fluid and may change rapidly.
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>
  <script>
  (function(){
    // Timestamp in UI
    document.getElementById('stamp').textContent = new Date().toISOString().slice(0,10);

    // --- Init map
    const map = L.map('map', { preferCanvas:true, zoomSnap:0.5, zoomDelta:0.5, minZoom:5, maxZoom:19 });

    // --- OpenStreetMap basemaps
    const osmStd = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    });
    const osmHOT = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors, tiles style by Humanitarian OpenStreetMap Team'
    }).addTo(map); // default

    const baseLayers = { 'OSM Humanitarian': osmHOT, 'OSM Standard': osmStd };

    // --- RSF control features (public reporting, Sep 2025)
    // Coordinates are [lon, lat]
    const rsfGeoJSON = {
      type:'FeatureCollection',
      features:[
        {
          type:'Feature',
          geometry:{ type:'Point', coordinates:[25.310667, 13.4885222] },
          properties:{
            id:'zamzam',
            name:'Zamzam IDP Camp',
            status:'Reported RSF control (13 Apr 2025 →), continued presence Sep 2025',
            updated:'2025-09-22',
            radius_m: 1800,
            refs:[
              {label:'Reuters/IOM', url:'https://www.reuters.com/world/africa/between-60000-80000-households-displaced-darfur-camp-after-sudan-rsf-takeover-2025-04-14/'},
              {label:'OCHA Flash', url:'https://www.unocha.org/publications/report/sudan/sudan-displacement-zamzam-camp-north-darfur-state-flash-update-no-3-2-may-2025'},
              {label:'Wikipedia (coords)', url:'https://en.wikipedia.org/wiki/Zamzam_Refugee_Camp'}
            ]
          }
        },
        {
          type:'Feature',
          geometry:{ type:'Point', coordinates:[25.350139, 13.6714833] },
          properties:{
            id:'abushouk',
            name:'Abu Shouk IDP Camp',
            status:'Assessed RSF control/presence (Aug–Sep 2025)',
            updated:'2025-09-22',
            radius_m: 1600,
            refs:[
              {label:'Yale HRL (Sep 2025)', url:'https://files-profile.medicine.yale.edu/documents/45e77af9-a3cb-4bae-9bc2-61efe1d1595f'},
              {label:'OHCHR (Aug 2025)', url:'https://www.ohchr.org/en/press-releases/2025/08/sudan-turk-outraged-after-rsf-kills-least-57-civilians-el-fasher-and-abu'}
            ]
          }
        }
      ]
    };

    const refPlaces = {
      type:'FeatureCollection',
      features:[
        { type:'Feature', geometry:{ type:'Point', coordinates:[25.34936, 13.62793] }, properties:{ name:'Al Fasher (city center, ref.)' } }
      ]
    };

    // Styles
    function rsfMarker(p){
      const d = 18;
      return L.divIcon({
        className:'rsf-dot',
        html:`<div style="width:${d}px;height:${d}px;border-radius:50%;background:var(--danger);box-shadow:0 0 0 2px #fff,0 0 16px rgba(239,68,68,.55);"></div>`,
        iconSize:[d,d], iconAnchor:[d/2,d/2]
      });
    }

    function makePopup(props){
      const links = (props.refs||[]).map(r=>`<a class="src-chip" href="${r.url}" target="_blank" rel="noopener">${r.label}</a>`).join(' ');
      return `
        <div style="min-width:240px">
          <h4 style="margin:0 0 6px;color:#cfe1ff">${escapeHtml(props.name)}</h4>
          <div style="font-size:13px;color:#c1cde6;margin-bottom:6px">${escapeHtml(props.status)}</div>
          <div style="font-size:12px;color:#9cb6e6"><strong>Updated:</strong> ${escapeHtml(props.updated||'')}
            <div style="margin-top:6px;display:flex;gap:6px;flex-wrap:wrap">${links}</div>
          </div>
          <div style="margin-top:8px;font-size:12px;color:#a8b9da">Extent circle shows an <em>approximate</em> footprint for visualization.</div>
        </div>`;
    }

    const rsfLayer = L.layerGroup();
    L.geoJSON(rsfGeoJSON, {
      pointToLayer: (feat, latlng) => L.marker(latlng, { icon: rsfMarker(feat.properties) }),
      onEachFeature: (feat, layer) => {
        layer.bindTooltip(feat.properties.name, { direction:'top', offset:[0,-4] });
        layer.bindPopup(makePopup(feat.properties));
        // Add a soft circle to approximate area
        const r = Number(feat.properties.radius_m)||1200;
        const halo = L.circle(layer.getLatLng(), {
          radius:r,
          color:'#ef4444', weight:1.25, opacity:0.9,
          fillColor:'#ef4444', fillOpacity:0.12, interactive:false
        }).addTo(rsfLayer);
        layer.on('add', ()=>halo.addTo(map));
        layer.on('remove', ()=>map.removeLayer(halo));
      }
    }).addTo(rsfLayer);

    const refsLayer = L.geoJSON(refPlaces, {
      pointToLayer: (f, ll) => L.circleMarker(ll, {
        radius:5, color:'#60a5fa', weight:2, fillColor:'#60a5fa', fillOpacity:0.4
      }).bindTooltip(f.properties.name, {direction:'top'})
    });

    rsfLayer.addTo(map);

    // Layer control
    const overlays = { 'RSF Control (approx.)': rsfLayer, 'Reference places': refsLayer };
    L.control.layers(baseLayers, overlays, { collapsed:true }).addTo(map);
    L.control.scale({ position:'bottomleft', metric:true, imperial:false }).addTo(map);

    // Fit to data
    const all = L.featureGroup([rsfLayer, refsLayer]).addTo(map);
    map.fitBounds(all.getBounds(), { padding:[24,24] });

    // Reset btn
    document.getElementById('btn-reset').addEventListener('click', ()=> map.fitBounds(all.getBounds(), { padding:[24,24] }));

    // small utilities
    function escapeHtml(str){ return String(str||'').replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])); }
  })();
  </script>
</body>
</html>
