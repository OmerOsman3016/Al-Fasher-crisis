<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow Monitoring Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 28px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        select, button {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1100px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            height: 400px;
        }
        
        .card-full {
            grid-column: 1 / -1;
            height: auto;
        }
        
        .card h2 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        #map {
            height: 100%;
            width: 100%;
            border-radius: 4px;
        }
        
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        .incoming {
            color: #27ae60;
        }
        
        .outgoing {
            color: #e74c3c;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .summary-card h3 {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .summary-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .incoming-card {
            border-left: 4px solid #27ae60;
        }
        
        .outgoing-card {
            border-left: 4px solid #e74c3c;
        }
        
        .legend {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        .incoming-color {
            background-color: #27ae60;
        }
        
        .outgoing-color {
            background-color: #e74c3c;
        }
        
        .point-details {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
        }
        
        .point-details h2 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .point-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .point-info-item {
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .point-info-item label {
            font-weight: bold;
            color: #7f8c8d;
            display: block;
            margin-bottom: 5px;
        }
        
        .monthly-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .month-item {
            text-align: center;
            padding: 8px;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .month-value {
            font-weight: bold;
            font-size: 16px;
        }
        
        .month-label {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .no-data {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header>
            <h1>Flow Monitoring Dashboard</h1>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color incoming-color"></div>
                    <span>Incoming</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color outgoing-color"></div>
                    <span>Outgoing</span>
                </div>
            </div>
        </header>
        
        <div class="summary-cards">
            <div class="summary-card incoming-card">
                <h3>Total Incoming</h3>
                <div class="value" id="total-incoming">0</div>
            </div>
            <div class="summary-card outgoing-card">
                <h3>Total Outgoing</h3>
                <div class="value" id="total-outgoing">0</div>
            </div>
            <div class="summary-card">
                <h3>Monitoring Points</h3>
                <div class="value" id="total-points">0</div>
            </div>
            <div class="summary-card">
                <h3>Latest Month</h3>
                <div class="value" id="latest-month">25-Aug</div>
            </div>
        </div>
        
        <div class="controls">
            <select id="direction-select">
                <option value="all">All Directions</option>
                <option value="Incoming">Incoming Only</option>
                <option value="Outgoing">Outgoing Only</option>
            </select>
            <select id="point-select">
                <option value="all">All Points</option>
            </select>
            <select id="month-select">
                <option value="all">All Months</option>
            </select>
            <button id="reset-filters">Reset Filters</button>
        </div>
        
        <div class="dashboard-grid">
            <div class="card">
                <h2>Monitoring Points Map</h2>
                <div id="map"></div>
            </div>
            
            <div class="card">
                <h2>Monthly Flow Trends</h2>
                <div class="chart-container">
                    <canvas id="trend-chart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="point-details">
            <h2>Point Details</h2>
            <div id="point-details-content">
                <div class="no-data">Select a point on the map to view details</div>
            </div>
        </div>
    </div>

    <script>
        // Sample data (would normally come from an API or database)
        const flowData = [
            {
                direction: "Incoming",
                pointName: "Argin",
                pointCode: "SD17014PB3",
                latitude: 21.988934,
                longitude: 31.153322,
                months: {
                    "24-Jan": 496, "24-Feb": 628, "24-Mar": 4413, "24-Apr": 712, "24-May": 1555,
                    "24-Jun": 1672, "24-Jul": 353, "24-Aug": 411, "24-Sep": 502, "24-Oct": 796,
                    "24-Nov": 606, "24-Dec": 807, "25-Jan": 561, "25-Feb": 454, "25-Mar": 425,
                    "25-Apr": 19950, "25-May": 21492, "25-Jun": 11329, "25-Jul": 16875, "25-Aug": 22604
                }
            },
            {
                direction: "Incoming",
                pointName: "Ashkeet",
                pointCode: "SD17014PB4",
                latitude: 22.000523,
                longitude: 31.511477,
                months: {
                    "24-Jan": 0, "24-Feb": 482, "24-Mar": 5114, "24-Apr": 135, "24-May": 747,
                    "24-Jun": 1481, "24-Jul": 167, "24-Aug": 152, "24-Sep": 513, "24-Oct": 728,
                    "24-Nov": 5043, "24-Dec": 14905, "25-Jan": 22809, "25-Feb": 29072, "25-Mar": 19791,
                    "25-Apr": 35074, "25-May": 14482, "25-Jun": 15636, "25-Jul": 21993, "25-Aug": 26116
                }
            },
            {
                direction: "Incoming",
                pointName: "Adekonk",
                pointCode: "SD04115PB6",
                latitude: 13.4623111,
                longitude: 22.2296523,
                months: {
                    "24-Jan": 0, "24-Feb": 0, "24-Mar": 0, "24-Apr": 0, "24-May": 0,
                    "24-Jun": 0, "24-Jul": 0, "24-Aug": 0, "24-Sep": 0, "24-Oct": 0,
                    "24-Nov": 0, "24-Dec": 0, "25-Jan": 0, "25-Feb": 0, "25-Mar": 0,
                    "25-Apr": 0, "25-May": 0, "25-Jun": 0, "25-Jul": 0, "25-Aug": 5771
                }
            },
            {
                direction: "Incoming",
                pointName: "Um Dukhun",
                pointCode: "SD06135PB5",
                latitude: 11.139,
                longitude: 22.966,
                months: {
                    "24-Jan": 0, "24-Feb": 0, "24-Mar": 0, "24-Apr": 0, "24-May": 0,
                    "24-Jun": 0, "24-Jul": 0, "24-Aug": 0, "24-Sep": 0, "24-Oct": 0,
                    "24-Nov": 0, "24-Dec": 0, "25-Jan": 0, "25-Feb": 0, "25-Mar": 0,
                    "25-Apr": 0, "25-May": 0, "25-Jun": 0, "25-Jul": 0, "25-Aug": 2835
                }
            },
            {
                direction: "Incoming",
                pointName: "Gallabat",
                pointCode: "SD12077PB1",
                latitude: 12.95798,
                longitude: 36.151888,
                months: {
                    "24-Jan": 0, "24-Feb": 0, "24-Mar": 0, "24-Apr": 0, "24-May": 0,
                    "24-Jun": 0, "24-Jul": 0, "24-Aug": 0, "24-Sep": 0, "24-Oct": 0,
                    "24-Nov": 0, "24-Dec": 0, "25-Jan": 0, "25-Feb": 0, "25-Mar": 0,
                    "25-Apr": 0, "25-May": 0, "25-Jun": 0, "25-Jul": 0, "25-Aug": 348
                }
            },
            {
                direction: "Outgoing",
                pointName: "Argin",
                pointCode: "SD17014PB3",
                latitude: 21.988934,
                longitude: 31.153322,
                months: {
                    "24-Jan": 0, "24-Feb": 0, "24-Mar": 0, "24-Apr": 0, "24-May": 0,
                    "24-Jun": 0, "24-Jul": 0, "24-Aug": 0, "24-Sep": 0, "24-Oct": 0,
                    "24-Nov": 0, "24-Dec": 0, "25-Jan": 0, "25-Feb": 0, "25-Mar": 0,
                    "25-Apr": 0, "25-May": 0, "25-Jun": 0, "25-Jul": 0, "25-Aug": 927
                }
            },
            {
                direction: "Outgoing",
                pointName: "Ashkeet",
                pointCode: "SD17014PB4",
                latitude: 22.000523,
                longitude: 31.511477,
                months: {
                    "24-Jan": 0, "24-Feb": 0, "24-Mar": 0, "24-Apr": 0, "24-May": 0,
                    "24-Jun": 0, "24-Jul": 0, "24-Aug": 0, "24-Sep": 0, "24-Oct": 0,
                    "24-Nov": 0, "24-Dec": 0, "25-Jan": 0, "25-Feb": 0, "25-Mar": 0,
                    "25-Apr": 0, "25-May": 0, "25-Jun": 0, "25-Jul": 0, "25-Aug": 519
                }
            },
            {
                direction: "Outgoing",
                pointName: "Adekonk",
                pointCode: "SD04115PB6",
                latitude: 13.4623111,
                longitude: 22.2296523,
                months: {
                    "24-Jan": 0, "24-Feb": 0, "24-Mar": 0, "24-Apr": 0, "24-May": 0,
                    "24-Jun": 0, "24-Jul": 0, "24-Aug": 0, "24-Sep": 0, "24-Oct": 0,
                    "24-Nov": 0, "24-Dec": 0, "25-Jan": 0, "25-Feb": 0, "25-Mar": 0,
                    "25-Apr": 0, "25-May": 0, "25-Jun": 0, "25-Jul": 0, "25-Aug": 5493
                }
            },
            {
                direction: "Outgoing",
                pointName: "Um Dukhun",
                pointCode: "SD06135PB5",
                latitude: 11.139,
                longitude: 22.966,
                months: {
                    "24-Jan": 0, "24-Feb": 0, "24-Mar": 0, "24-Apr": 0, "24-May": 0,
                    "24-Jun": 0, "24-Jul": 0, "24-Aug": 0, "24-Sep": 0, "24-Oct": 0,
                    "24-Nov": 0, "24-Dec": 0, "25-Jan": 0, "25-Feb": 0, "25-Mar": 0,
                    "25-Apr": 0, "25-May": 0, "25-Jun": 0, "25-Jul": 0, "25-Aug": 2127
                }
            },
            {
                direction: "Outgoing",
                pointName: "Gallabat",
                pointCode: "SD12077PB1",
                latitude: 12.95798,
                longitude: 36.151888,
                months: {
                    "24-Jan": 0, "24-Feb": 0, "24-Mar": 0, "24-Apr": 0, "24-May": 0,
                    "24-Jun": 0, "24-Jul": 0, "24-Aug": 0, "24-Sep": 0, "24-Oct": 0,
                    "24-Nov": 0, "24-Dec": 0, "25-Jan": 0, "25-Feb": 0, "25-Mar": 0,
                    "25-Apr": 0, "25-May": 0, "25-Jun": 0, "25-Jul": 0, "25-Aug": 2667
                }
            }
        ];

        // Global variables
        let map, trendChart, selectedPoint = null;

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            populateFilters();
            updateSummary();
            createTrendChart();
            
            // Add event listeners for filters
            document.getElementById('direction-select').addEventListener('change', applyFilters);
            document.getElementById('point-select').addEventListener('change', applyFilters);
            document.getElementById('month-select').addEventListener('change', applyFilters);
            document.getElementById('reset-filters').addEventListener('click', resetFilters);
        });

        // Initialize the map with Leaflet
        function initializeMap() {
            // Create map centered on the average coordinates of the points
            map = L.map('map').setView([15, 30], 4);
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);
            
            // Add markers for each monitoring point
            flowData.forEach(point => {
                const color = point.direction === 'Incoming' ? 'green' : 'red';
                const marker = L.circleMarker([point.latitude, point.longitude], {
                    color: color,
                    fillColor: color,
                    fillOpacity: 0.7,
                    radius: 8
                }).addTo(map);
                
                // Add click event to show point details
                marker.on('click', function() {
                    showPointDetails(point);
                });
                
                // Add popup with point information
                marker.bindPopup(`
                    <b>${point.pointName}</b><br>
                    Direction: ${point.direction}<br>
                    Code: ${point.pointCode}<br>
                    Latest Flow: ${point.months['25-Aug'].toLocaleString()}
                `);
            });
        }

        // Populate filter dropdowns
        function populateFilters() {
            const pointSelect = document.getElementById('point-select');
            const monthSelect = document.getElementById('month-select');
            
            // Get unique point names
            const pointNames = [...new Set(flowData.map(item => item.pointName))];
            pointNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                pointSelect.appendChild(option);
            });
            
            // Get all months from the data
            const months = Object.keys(flowData[0].months);
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                monthSelect.appendChild(option);
            });
        }

        // Update summary cards
        function updateSummary() {
            // Calculate totals
            const totalIncoming = flowData
                .filter(point => point.direction === 'Incoming')
                .reduce((sum, point) => sum + Object.values(point.months).reduce((a, b) => a + b, 0), 0);
                
            const totalOutgoing = flowData
                .filter(point => point.direction === 'Outgoing')
                .reduce((sum, point) => sum + Object.values(point.months).reduce((a, b) => a + b, 0), 0);
                
            // Update DOM
            document.getElementById('total-incoming').textContent = totalIncoming.toLocaleString();
            document.getElementById('total-outgoing').textContent = totalOutgoing.toLocaleString();
            document.getElementById('total-points').textContent = flowData.length;
        }

        // Create trend chart
        function createTrendChart() {
            const ctx = document.getElementById('trend-chart').getContext('2d');
            
            // Get all months
            const months = Object.keys(flowData[0].months);
            
            // Calculate totals by month and direction
            const incomingTotals = months.map(month => 
                flowData
                    .filter(point => point.direction === 'Incoming')
                    .reduce((sum, point) => sum + point.months[month], 0)
            );
            
            const outgoingTotals = months.map(month => 
                flowData
                    .filter(point => point.direction === 'Outgoing')
                    .reduce((sum, point) => sum + point.months[month], 0)
            );
            
            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Incoming',
                            data: incomingTotals,
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'Outgoing',
                            data: outgoingTotals,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Flow Count'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Month'
                            }
                        }
                    }
                }
            });
        }

        // Show point details
        function showPointDetails(point) {
            selectedPoint = point;
            const detailsContent = document.getElementById('point-details-content');
            
            // Calculate point statistics
            const monthlyValues = Object.values(point.months);
            const totalFlow = monthlyValues.reduce((a, b) => a + b, 0);
            const avgFlow = totalFlow / monthlyValues.length;
            const maxFlow = Math.max(...monthlyValues);
            const maxMonth = Object.keys(point.months).find(key => point.months[key] === maxFlow);
            
            // Create HTML for point details
            detailsContent.innerHTML = `
                <div class="point-info">
                    <div class="point-info-item">
                        <label>Point Name</label>
                        <div>${point.pointName}</div>
                    </div>
                    <div class="point-info-item">
                        <label>Point Code</label>
                        <div>${point.pointCode}</div>
                    </div>
                    <div class="point-info-item">
                        <label>Direction</label>
                        <div class="${point.direction.toLowerCase()}">${point.direction}</div>
                    </div>
                    <div class="point-info-item">
                        <label>Coordinates</label>
                        <div>${point.latitude.toFixed(6)}, ${point.longitude.toFixed(6)}</div>
                    </div>
                    <div class="point-info-item">
                        <label>Total Flow</label>
                        <div>${totalFlow.toLocaleString()}</div>
                    </div>
                    <div class="point-info-item">
                        <label>Average Monthly Flow</label>
                        <div>${avgFlow.toFixed(0).toLocaleString()}</div>
                    </div>
                    <div class="point-info-item">
                        <label>Peak Flow</label>
                        <div>${maxFlow.toLocaleString()} (${maxMonth})</div>
                    </div>
                </div>
                <h3>Monthly Breakdown</h3>
                <div class="monthly-breakdown">
                    ${Object.entries(point.months).map(([month, value]) => `
                        <div class="month-item">
                            <div class="month-value">${value.toLocaleString()}</div>
                            <div class="month-label">${month}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Apply filters to the chart
        function applyFilters() {
            const directionFilter = document.getElementById('direction-select').value;
            const pointFilter = document.getElementById('point-select').value;
            const monthFilter = document.getElementById('month-select').value;
            
            // Get all months
            const months = Object.keys(flowData[0].months);
            
            let filteredIncomingData = [];
            let filteredOutgoingData = [];
            
            // Apply direction filter
            if (directionFilter === 'all' || directionFilter === 'Incoming') {
                filteredIncomingData = months.map(month => 
                    flowData
                        .filter(point => point.direction === 'Incoming' && 
                               (pointFilter === 'all' || point.pointName === pointFilter))
                        .reduce((sum, point) => sum + point.months[month], 0)
                );
            }
            
            if (directionFilter === 'all' || directionFilter === 'Outgoing') {
                filteredOutgoingData = months.map(month => 
                    flowData
                        .filter(point => point.direction === 'Outgoing' && 
                               (pointFilter === 'all' || point.pointName === pointFilter))
                        .reduce((sum, point) => sum + point.months[month], 0)
                );
            }
            
            // Apply month filter to the chart display
            if (monthFilter !== 'all') {
                const monthIndex = months.indexOf(monthFilter);
                if (monthIndex !== -1) {
                    // Show only the selected month
                    const singleMonthData = Array(months.length).fill(0);
                    singleMonthData[monthIndex] = filteredIncomingData[monthIndex] + filteredOutgoingData[monthIndex];
                    
                    trendChart.data.labels = months.map((m, i) => i === monthIndex ? m : '');
                    trendChart.data.datasets[0].data = directionFilter !== 'Outgoing' ? 
                        singleMonthData.map((v, i) => i === monthIndex ? filteredIncomingData[i] : 0) : 
                        Array(months.length).fill(0);
                    trendChart.data.datasets[1].data = directionFilter !== 'Incoming' ? 
                        singleMonthData.map((v, i) => i === monthIndex ? filteredOutgoingData[i] : 0) : 
                        Array(months.length).fill(0);
                }
            } else {
                // Show all months
                trendChart.data.labels = months;
                trendChart.data.datasets[0].data = directionFilter !== 'Outgoing' ? filteredIncomingData : Array(months.length).fill(0);
                trendChart.data.datasets[1].data = directionFilter !== 'Incoming' ? filteredOutgoingData : Array(months.length).fill(0);
            }
            
            trendChart.update();
        }

        // Reset all filters
        function resetFilters() {
            document.getElementById('direction-select').value = 'all';
            document.getElementById('point-select').value = 'all';
            document.getElementById('month-select').value = 'all';
            createTrendChart();
        }
    </script>
</body>
</html>
